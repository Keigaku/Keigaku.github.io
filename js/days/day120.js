// ===========================
// Day 120: リスク管理
// ===========================
window.Day120 = {
    render(container, dayNum) {
        const dayInfo = Navigation.days[dayNum - 1];
        const sections = `
            <div class="content-section animate-in">
                <h2>⚠️ リスク管理 (Risk Management)</h2>
                <div class="info-box">
                    <div class="info-box-title">📋 プロアクティブの極致</div>
                    <p>金融システム開発におけるリスク（例：サイバー攻撃、規制変更による仕様のちゃぶ台返し、キーマンの退職）は、起きてから対処するのでは遅すぎます。
                    PMPにおいてPMの最も重要な業務の一つが、「不確実性」を事前に特定し、定量化し、対策を打つ（プロアクティブな）リスク管理です。</p>
                </div>
                
                <h3>脅威（マイナスのリスク）と機会（プラスのリスク）</h3>
                <p>PMPでは、リスクを「プロジェクトの目標に影響を与える不確実な事象」と定義しており、悪いこと（脅威）だけでなく、<strong>良いこと（機会：予定より早く終わる、新しい技術でコストが下がる等）もリスクとして管理します。</strong></p>

                <div class="info-box important">
                    <div class="info-box-title">🛡️ リスク対応戦略（戦略の種類を問われる問題が頻出）</div>
                    <table class="styled-table">
                        <thead><tr><th>マイナスのリスク（脅威）の対応</th><th>プラスのリスク（機会）の対応</th></tr></thead>
                        <tbody>
                            <tr><td><strong>回避 (Avoid):</strong><br>リスクの原因自体を排除する。（例：その機能の開発をスコープから削る、脆弱なAPIの使用をやめる）</td><td><strong>活用 (Exploit):</strong><br>機会が確実に起きるようにする。（例：優秀な外部専門家を高い金で雇い、予定より早く終わらせる）</td></tr>
                            <tr><td><strong>転嫁 (Transfer):</strong><br>第三者に影響と責任を移す。（例：損害保険に入る、定額契約でベンダーに開発リスクを負わせる）</td><td><strong>共有 (Share):</strong><br>第三者と利益を分かち合う。（例：他社とジョイントベンチャーを組み、新市場開拓の利益を共有する）</td></tr>
                            <tr><td><strong>軽減 (Mitigate):</strong><br>発生確率や影響度を小さくする。（例：サーバーを冗長化する、プロトタイプを作って技術検証する）</td><td><strong>強化 (Enhance):</strong><br>発生確率や利益を大きくする。（例：追加リソースを投入して、ボーナス要件の達成確率を上げる）</td></tr>
                            <tr><td colspan="2"><strong>受容 (Accept):</strong><br>何もしない。ただし、リスクが起きた時のためのコンティンジェンシー予備（予備予算）や対応計画（Plan B）を用意しておく「能動的受容」と、本当に何もしない「受動的受容」がある。</td></tr>
                            <tr><td colspan="2"><strong>エスカレーション (Escalate):</strong><br>PMの権限外（全社的なリスクなど）のため、スポンサー等（上位マネジメント）に報告して対応を委ねる。</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="content-section animate-in stagger-1">
                <h2>🧮 リスクの定量化（EMVとデシジョンツリー）</h2>
                <p>特定したリスクに対し、「どのくらいヤバいか」を金額（期待金額価値）で計算し、スポンサーに提示する予算（コンティンジェンシー予備）の根拠にします。</p>

                <h3>EMV (Expected Monetary Value: 期待金額価値)</h3>
                <p>計算式： <strong>EMV = 発生確率(%) × 影響額(金額)</strong></p>
                <ul>
                    <li>リスクA（新法規制対応で再設計になるリスク）: 確率30%、損失5,000万円 → EMV = <span style="color:var(--accent-red);">-1,500万円</span></li>
                    <li>リスクB（新AIモデルで処理コストが下がる機会）: 確率20%、利益3,000万円 → EMV = <span style="color:var(--accent-green);">+600万円</span></li>
                    <li>プロジェクト全体のリスクEMV（コンティンジェンシー予備の目安） = <span style="color:var(--accent-red);">-900万円</span></li>
                </ul>

                <h3>デシジョン・ツリー分析</h3>
                <p>複数の選択肢（例：内製するか、外注するか）がある場合、それぞれのリスクEMVを計算して、統計的に最も有利な（コストの低い、または利益の高い）選択肢を論理的に決定する手法です。（※PMP試験では単純な計算問題として出ます）。</p>
            </div>

            <div class="content-section animate-in stagger-2">
                <h2>📋 リスク登録簿 (Risk Register)</h2>
                <p>特定されたすべての個別リスク、その原因、EMV（優先順位）、対応戦略、そして<strong>リスク所有者（Risk Owner：そのリスクの監視と対応の実行に責任を持つ人）</strong>を一覧化した、リスク管理の中核となるドキュメントです。</p>
                <div class="info-box tip">
                    <div class="info-box-title">💡 PMP状況問題の鉄則</div>
                    <p>プロジェクトの途中で新しい予期せぬリスク（例：「新しい競合サービスが発表された」）が発見された場合、PMが真っ先に行うべき行動の正解は常に<strong>「リスク登録簿（Risk Register）を更新する（追加する）」</strong>です。会議をひらいたり、スポンサーにすぐ報告するのはその後です。</p>
                </div>
            </div>

            <div id="day120-quiz"></div>
        `;
        Navigation.renderDayTemplate(container, dayNum, dayInfo, sections);

        QuizEngine.render('day120-quiz', 'day120-quiz', [
            { question: '【PMP状況問題】金融庁のガイドライン変更の噂があり、もし変更が確定するとシステムの大幅な再設計が必要となり、数千万円の損失が出ます。PMはこの機能を後回しにし、変更内容が確定するまでそのモジュールの開発を行わないことを決定しました。これはどのリスク対応戦略に該当しますか？', options: ['転嫁 (Transfer)', '軽減 (Mitigate)', '回避 (Avoid)', '受容 (Accept)'], correct: 3, explanation: 'リスクの発生原因を取り除くこと（ここでは、問題となる設計作業自体を後回し・スコープ外とすること）で、脅威からの影響を100%確実にゼロにするアプローチは「回避（Avoid）」です。確率や影響を減らす「軽減」とは異なります（回避＝確率0%）。' },
            { question: '新システムの海外でのサーバー運用について、自然災害によるダウンタイムリスクが懸念されています。PMは多額の費用を払って、SLA（サービスレベル合意）による厳格な稼働率保証と、ダウン時の損害賠償条項を含んだ契約を外部のクラウドベンダーと結びました。これはどのリスク対応戦略に該当しますか？', options: ['軽減 (Mitigate)', '転嫁 (Transfer)', '回避 (Avoid)', 'エスカレーション (Escalate)'], correct: 2, explanation: 'リスクによる財務的影響や対応の責任を、保険や契約によって第三者（ベンダー）に「移す」戦略が「転嫁（Transfer）」です。ただし、リスクの根本的発生がなくなるわけではありません（賠償金は得られますが、ダウンタイム自体は発生するかもしれません）。' },
            { question: '【PMP状況問題】チームメンバーからの報告で、使用予定だったソフトウェアライブラリに致命的なセキュリティ脆弱性が発見され、そのままではリリースできないことが判明しました。このプロジェクトには同種のリスクの発生記録はありませんでした。PMが【最初】に行うべき行動はどれですか？', options: ['スポンサーに直ちに連絡し、予算の追加を要求する。', 'リスク登録簿（Risk Register）にこの脆弱性のリスクを追記・更新する。', '代替となるライブラリの購入手続きを緊急で開始する。', 'プロジェクトを一時停止する。'], correct: 2, explanation: '新しいリスク（脅威または機会）が特定された場合、PMが最初に必ず行うべき手続きは「リスク登録簿への文書化（登録・更新）」です。その上で、影響の分析、対応策（ワークアラウンドなど）の策定、変更管理プロセスへと進みます。' },
            { question: '以下の2つの選択肢をデシジョン・ツリーで比較します。<br>【選択肢A：内製する】 コスト3,000万円。ただし40%の確率で統合エラーのリスクがあり、その場合の修正費用は1,000万円。<br>【選択肢B：外注する】 定額契約コスト3,500万円。リスクによる追加費用はゼロ（転嫁済み）。<br>純粋な期待金額価値（EMV）の観点から、コストが低い（有利な）選択肢はどちらであり、その総EMV（初期コスト＋リスクEMV）はいくらですか？', options: ['選択肢A / 3,400万円', '選択肢A / 4,000万円', '選択肢B / 3,500万円', '選択肢B / 2,500万円'], correct: 1, explanation: 'Aの初期コストは3000万。リスクEMVは「1000万 × 40% = 400万」。Aの総コストの期待値は 3000 + 400 = 3,400万円です。Bのコストは確定で3,500万円。したがって、EMVの観点からは3,400万円で済む「選択肢A（内製）」の方が統計的に有利（安価）であると判断されます。' },
            { question: 'ある機能開発において、新しいアルゴリズムを使用することで、処理速度の要件を予定より早くクリアし、開発期間を1週間短縮できるかもしれない「機会（プラスのリスク）」が発見されました。PMは、この機会を実現する確率と得られる利益を最大化するため、チーム内で最高のアルゴリズム設計スキルを持つシニア・クオンツをこのタスクに追加アサインしました。どの対応戦略ですか？', options: ['活用 (Exploit)', '強化 (Enhance)', '共有 (Share)', '軽減 (Mitigate)'], correct: 2, explanation: '「活用」は機会の発生確率を確実に100%にする（必ず恩恵を受けられるようにする）ための戦略です。一方「強化」は、今回のように追加リソースを使って発生の「確率を高める」か、実現した際の「利益率を上げる（期間をさらに2週間短縮できるようにする等）」アプローチです。' }
        ]);
    }
};
