// ===========================
// Day 123: コンプライアンス・セキュリティと規制対応
// ===========================
window.Day123 = {
    render(container, dayNum) {
        const dayInfo = Navigation.days[dayNum - 1];
        const sections = `
            <div class="content-section animate-in">
                <h2>🏛️ Domain 3: Business Environment (ビジネス環境)
                <br>コンプライアンスとプロジェクトの統合</h2>
                <div class="info-box">
                    <div class="info-box-title">📋 規制遵守（Compliance）は最優先事項</div>
                    <p>金融システム開発において、コンプライアンス（法令順守）や監査基準（FSA、Basel、GDPR、PCIDSSなど）は、「あれば良い機能」ではなく「プロジェクト存続の絶対条件（Must-Have）」です。</p>
                </div>
                
                <h3>コンプライアンスの組み込み（Compliance by Design）</h3>
                <p>プロジェクトの最終テスト段階になってから監査部門を呼んでセキュリティチェックを行うのは、PMPでは「手遅れ（非効率）」とされます。初期段階から規制をプロジェクトに組み込む必要があります。</p>

                <div class="info-box tip">
                    <div class="info-box-title">💡 コンプライアンス対応のベストプラクティス</div>
                    <ul class="feature-list">
                        <li><strong>初期段階の関与:</strong> 要件定義やプロジェクト・バックログの作成段階から、監査部門や法務・コンプラ部門を（ステークホルダーとして）巻き込み、RACIチャートの「Consulted (C)」に指定する。</li>
                        <li><strong>非機能要件としての定義:</strong> セキュリティ、監査ログの保持期間、個人情報保護などを「非機能要件（Product Scopeの一部）」またはアジャイルの「完了の定義（Definition of Done: DoD）」として明確化する。</li>
                        <li><strong>規制変更というリスク:</strong> プロジェクト中に法律が変わるリスクは常に存在します（例：消費税率の変更や新アルゴリズム規制）。PMはこれを「リスク登録簿」で管理し、影響を評価するプロセスを持たねばなりません。</li>
                    </ul>
                </div>
            </div>

            <div class="content-section animate-in stagger-1">
                <h2>🕵️‍♂️ 監査 (Audit) と検査 (Inspection)</h2>
                <p>PMPの品質管理と調達管理において、第三者の目による確認プロセスは重要です。</p>

                <table class="styled-table">
                    <thead><tr><th>用語</th><th>目的と対象</th><th>金融での具体例</th></tr></thead>
                    <tbody>
                        <tr><td><strong>品質の監査<br>(Quality Audit)</strong></td><td>【プロセス】の確認。<br>「プロジェクトが組織の正しいルールや手順（テスト方針等）に従って実施されているか」を独立した第三者（PMOや内部監査部門）がチェックする。プロセス改善が目的。</td><td>開発中のソースコードに対し、組織が定めたセキュアコーディング規約（静的解析ツールの使用など）が正しく運用されているかをPMOが確認する。</td></tr>
                        <tr><td><strong>検査<br>(Inspection)</strong></td><td>【成果物（プロダクト）】の確認。<br>作られたもの自体が要件（スコープ・ベースラインや仕様書）に合致しているかをチェックする。</td><td>完成したログイン画面について、パスワードが暗号化されてDBに保存されているかを実際にテスト・レビューする。</td></tr>
                        <tr><td><strong>調達監査<br>(Procurement Audit)</strong></td><td>【調達プロセス】の確認。<br>ベンダー選定の入札から契約、納品までのプロセスが公正かつ適切に行われたかをレビューし、将来の調達に向けた教訓（Lessons Learned）を得る。</td><td>SIer選定の稟議プロセスで、利益相反がなかったか、評価基準が適切だったかを監査部門が確認する。</td></tr>
                    </tbody>
                </table>
            </div>

            <div id="day123-quiz"></div>
        `;
        Navigation.renderDayTemplate(container, dayNum, dayInfo, sections);

        QuizEngine.render('day123-quiz', 'day123-quiz', [
            { question: '【PMP状況問題】現在、グローバルな顧客情報管理システムの開発がスプリント3まで進んでおり、すでに一部機能がリリース寸前です。この時、法務・コンプライアンス部門の担当者から「このシステム設計では来月から施行される新しい個人情報保護法（GDPRなど）のデータ削除要件（忘れられる権利）を満たしていない。最優先で対応が必要だ」と指摘を受けました。PMが最初に行うべき行動はどれですか？', options: ['既にリリース寸前なので、このスプリントでは無視し、次回のフェーズ2で対応するよう法務担当者を説得する。', 'コンプライアンス要件に対する変更要求（Change Request）を起票し、この変更がプロジェクトのスコープ、スケジュール、コストに与える影響を分析・評価する。', '直ちに開発チームの現在の作業をすべて中断させ、データ削除機能の実装を強制的に開始させる。', '法務部門をプロジェクト初期から巻き込んでいなかったスクラムマスターを叱責する。'], correct: 2, explanation: 'コンプライアンスや法律の要件は「必須（Must）」であり無視（先送り）することはできません。しかし、PMIイズムの黄金律の一つ「変更要求があった場合は、【すぐに行動する前に】まず影響を評価・分析し、正式な変更管理プロセスを通す」に従う必要があります。' },
            { question: 'システム開発プロジェクトにおける「品質の監査（Quality Audit）」の主な目的として最も適切なものはどれですか？', options: ['開発されたソースコードにバグがないかを、一文ずつ検査すること。', 'プロジェクトチームが、組織の指定された品質・開発プロセスや方針に正しく従っているかを、独立した第三者（PMOなど）が客観的にレビューし、改善点を見つけること。', 'プロジェクトにかかったコストが予算内に収まっているかを、財務部門が確認すること。', '完成したシステムが顧客の要件仕様書に100%合致しているかを、顧客と共に確認（受け入れ）すること。'], correct: 2, explanation: 'PMPにおける「品質監査」は、成果物（バグ探し）ではなく「プロセス（働き方・手順）」を対象とします。「正しい手順（承認フローやテスト規約）を踏んで開発・プロジェクト運営が行われているか」をチェックし、効率化や教訓を得ることが目的です。成果物（プロダクト）自体のバグチェック等は「検査（Inspection）」と呼びます。' },
            { question: 'アジャイル開発（スクラムなど）において、セキュリティ要件や監査ログの実装など、コンプライアンス上の必須要件（ノンファンクショナル要件）をすべての機能（ユーザーストーリー）で確実に満たさせるための仕組みとして、最も適しているものはどれですか？', options: ['スプリント・レトロスペクティブ', 'Definition of Done (DoD : 完了の定義)', 'プロダクト・バックログ・リファインメント', 'タイムボックス'], correct: 2, explanation: '「完了の定義（DoD）」とは、そのタスクやストーリーが「本当に終わった」とみなすために満たすべき条件のチェックリスト（例：「コードレビュー完了」「単体テスト網羅率80%」「セキュリティスキャン通過」など）です。コンプライアンスや非機能要件をDoDに組み込むことで、品質や規制要件を全ての開発機能に自動的に強制することができます。' },
            { question: '【PMP状況問題】金融システムの海外拠点展開プロジェクトを計画しています。進出先の国の規制や法律が非常に複雑で、プロジェクト期間中に何度も変更される可能性があることが判明しました。この「コンプライアンス変更リスク」に対処するためのPMPのアプローチとして最も【不適切】なものはどれですか？', options: ['プロジェクトの「リスク登録簿」にこの事項を追加し、継続的に監視し対応戦略を立てる。', '現地の法律専門家（SME）をステークホルダー（コンサルタント等）として早期にプロジェクトプロセスに巻き込む。', '発生の不確実性が高いリスクであるため、詳細なスケジュールとスコープを全て固定した予測型（ウォーターフォール）アプローチを採用する。', '要件の変更に柔軟に対応しやすくするため、アジャイルやハイブリッドアプローチの適用を検討する。'], correct: 3, explanation: '法律や環境の「変更が頻繁に発生する」ことが予想される（不確実性が高い）場合、要件をガチガチに固定して変更を嫌う「完全な予測型（ウォーターフォール）」アプローチを選択するのは最適ではありません。変更を歓迎し、短いサイクルで適応していくアジャイルや、一部にそれを適用するハイブリッドアプローチが適しています。' }
        ]);
    }
};
