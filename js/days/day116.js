// ===========================
// Day 116: スケジュール管理
// ===========================
window.Day116 = {
    render(container, dayNum) {
        const dayInfo = Navigation.days[dayNum - 1];
        const sections = `
            <div class="content-section animate-in">
                <h2>📅 スケジュール管理 (Schedule Management)</h2>
                <div class="info-box">
                    <div class="info-box-title">📋 致命的な「遅延」を防ぐ技術</div>
                    <p>金融システムのカットオーバー（本番稼働）日は、法規制や決算期に紐づいていることが多く、絶対に遅らせることができない「ハード・デッドライン」であることが多々あります。
                    PMは論理的かつ数学的な手法でスケジュールをコントロールします。</p>
                </div>
                
                <h3>クリティカルパス法 (CPM: Critical Path Method)</h3>
                <p>プロジェクト全体の期間を決定する「最も時間のかかる（余裕ゼロの）経路」を見つけ出す手法です。</p>
                
                <table class="styled-table">
                    <thead><tr><th>アクティビティ</th><th>所要日数</th><th>先行アクティビティ</th></tr></thead>
                    <tbody>
                        <tr><td>A. 要件定義</td><td>5日</td><td>-</td></tr>
                        <tr><td>B. DB設計</td><td>3日</td><td>A</td></tr>
                        <tr><td>C. UI設計</td><td>4日</td><td>A</td></tr>
                        <tr><td>D. バックエンド実装</td><td>6日</td><td>B</td></tr>
                        <tr><td>E. フロントエンド実装</td><td>5日</td><td>C</td></tr>
                        <tr><td>F. 結合テスト</td><td>3日</td><td>D, E</td></tr>
                    </tbody>
                </table>
                <p><strong>経路1（DB経由）:</strong> A(5) + B(3) + D(6) + F(3) = <strong>17日</strong></p>
                <p><strong>経路2（UI経由）:</strong> A(5) + C(4) + E(5) + F(3) = <strong>17日</strong></p>
                <p>この場合、どちらの経路遅れてもクリティカル（17日→18日）になります。クリティカルパス上のタスクは「フロート（余裕日数）がゼロ」です。</p>

                <div class="info-box tip">
                    <div class="info-box-title">⚡ 遅延を回復する2つの手法（スケジュール短縮）</div>
                    <ul class="feature-list">
                        <li><strong>クラッシング (Crashing):</strong><br>コスト（残業代、追加リソース、特急料金）をかけて期間を短縮する。「コスト増加」のリスクがある。クリティカルパス上のタスクにのみ適用。</li>
                        <li><strong>ファスト・トラッキング (Fast Tracking):</strong><br>本来は順番に行う作業（例：設計と実装）を、並行して進める。「手戻りのリスク（バグの増加など）」がある。</li>
                    </ul>
                </div>
            </div>

            <div class="content-section animate-in stagger-1">
                <h2>🎲 見積もり技法 (Estimating Techniques)</h2>
                <p>スケジュールやコストを「どうやって見積もるか」は、PMの実力が問われる部分です。</p>
                
                <table class="styled-table">
                    <thead><tr><th>見積もり技法</th><th>特徴・使用シーン</th><th>精度と労力</th></tr></thead>
                    <tbody>
                        <tr><td><strong>類推見積もり</strong><br>(Analogous)</td><td>過去の類似プロジェクトのデータを元に「あの時3ヶ月かかったから、今回もそれくらい」とざっくり出す。トップダウン。</td><td>精度：低<br>労力：小（早い）</td></tr>
                        <tr><td><strong>パラメトリック見積もり</strong><br>(Parametric)</td><td>統計データや変数を使う。「1画面2日 × 50画面 = 100日」のように計算で出す。</td><td>精度：中〜高<br>労力：中</td></tr>
                        <tr><td><strong>ボトムアップ見積もり</strong><br>(Bottom-up)</td><td>WBSの最下層（ワーク・パッケージ）を一つずつ詳細に見積もり、全てを足し合わせる。</td><td>精度：最も高い<br>労力：特大（時間がかかる）</td></tr>
                        <tr><td><strong>三点見積もり (PERT法)</strong><br>(Three-point)</td><td>不確実性が高い場合に、「楽観値(O)」「最尤値(M)」「悲観値(P)」の3点から加重平均を出す。</td><td>リスクを考慮できる</td></tr>
                    </tbody>
                </table>

                <div class="info-box important">
                    <div class="info-box-title">🧮 PERT法の計算式 (ベータ分布)</div>
                    <p style="font-size:1.2rem; text-align:center; margin: 10px 0;"><strong>期待値 (tE) = ( O + 4M + P ) / 6</strong></p>
                    <p>例：楽観値(O)＝4日、最尤値(M)＝5日、悲観値(P)＝12日（インフラ基盤側のAPI連携にバグが潜んでいるリスク）。<br>
                    (4 + (4×5) + 12) / 6 = 36 / 6 = <strong>6日</strong> と見積もる。</p>
                </div>
            </div>

            <div class="content-section animate-in stagger-2">
                <h2>🔄 アジャイルにおける見積もり（ストーリーポイント）</h2>
                <p>アジャイルでは「時間単位（Man-Hour, Day）」ではなく、<strong>相対的なサイズや複雑さの単位（ストーリーポイント等）</strong>で見積もりを行います。</p>
                <ul>
                    <li><strong>プランニング・ポーカー:</strong> チーム全員で一斉にカード（フィボナッチ数列: 1, 2, 3, 5, 8, 13...）を出してサイズを見積もる。意見の相違があれば議論し、合意を形成する。（エンパワーメントの実践）</li>
                    <li><strong>ベロシティ (Velocity):</strong> 1スプリント（例：2週間）でチームが完了できたストーリーポイントの合計。「今回もベロシティ通り30ポイント分積もう」と予測を立てる。PMが目標値として押し付けるものではない。</li>
                </ul>
            </div>

            <div id="day116-quiz"></div>
        `;
        Navigation.renderDayTemplate(container, dayNum, dayInfo, sections);

        QuizEngine.render('day116-quiz', 'day116-quiz', [
            { question: '【PMP状況問題】金融庁の監査対応システムの開発を行っています。法定期限が迫っており、クリティカルパス上の「データ移行」アクティビティに遅延が発生しています。予算にはまだ余裕があります。スケジュールを回復するためにPMが取るべき手法として最も適切なものはどれですか？', options: ['スケジュールのベースラインを変更し、法定期限の延長を申請する。', 'リソースの平準化（Resource Leveling）を実施する。', '追加の人員をアサインするか、残業を許可して期間を短縮する（クラッシング）。', 'テスト工程と移行工程を並行して行い、期間を短縮する（ファスト・トラッキング）。'], correct: 2, explanation: '予算に余裕があり、システム（法対応）に対する品質/リスクへの影響を最小限に抑えつつスケジュールを短縮したい場合、コストを犠牲にして期間を買う「クラッシング（Crashing）」が最適です。ファスト・トラッキング（並行作業）は手戻りやバグのリスク（品質リスク）を増大させるため、第二の選択肢となります。' },
            { question: 'PERT（三点見積もり・ベータ分布）を使用してタスクの見積もりを行います。楽観値が10日、最尤値が15日、悲観値が26日だった場合、スケジュール上の期待値（見積もり日数）は何日になりますか？', options: ['15日', '16日', '17日', '18日'], correct: 1, explanation: 'PERTの計算式は (O + 4M + P) / 6 です。 (10 + 4*15 + 26) / 6 = (10 + 60 + 26) / 6 = 96 / 6 = 16日 となります。不確実性（悲観的な長引くリスク）を加重平均によって見積もりに組み込む手法です。' },
            { question: 'プロジェクトの立ち上げフェーズで、まだ詳細な要件やWBSが存在しません。しかし、スポンサーから「大体の予算とスケジュールを明日までに教えてほしい」と要求されました。どの見積もり技法を使用するのが適切ですか？', options: ['ボトムアップ見積もり', '類推見積もり (Analogous Estimating)', '三点見積もり (Three-point Estimating)', 'プランニング・ポーカー'], correct: 1, explanation: '詳細な情報がなく、かつ短時間で大まかな見積もり（Rough Order of Magnitude: ROM）を出す必要がある場合は、過去の類似プロジェクトの経験やデータに基づくトップダウンのアプローチである「類推見積もり（Analogous）」を使用します。精度は低いですが最も早く回答できます。' },
            { question: 'クリティカルパスに関する説明として【誤っている】ものはどれですか？', options: ['プロジェクトネットワーク図の中で、最も期間が長い経路である。', 'クリティカルパス上のアクティビティは、原則としてフロート（余裕）がゼロである。', 'プロジェクトには複数のクリティカルパスが存在する可能性がある。', 'クリティカルパス上のタスクが早く終わっても、プロジェクト全体の期間は変わらない。'], correct: 3, explanation: 'クリティカルパス上のタスクが早く終われば、当然プロジェクト全体の期間も短くなります（他のパスが新たなクリティカルパスにならない限り）。逆に、1日でも遅れれば即座にプロジェクト全体の遅れに直結する最も重要な経路です。' },
            { question: '【PMP状況問題】アジャイルチームのスクラムマスターを務めています。マネージャーから「チームのベロシティ（Velocity）をもっと上げるようにメンバーに発破をかけ、コミットさせろ」と指示を受けました。PMPのアジャイル・マインドセットにおいて、この指示への対応として適切なものはどれですか？', options: ['指示に従い、次のスプリントからより高いポイントを完了するようチームに要求する。', 'ベロシティはチームの能力を測る経験的指標であり、目標値としてノルマ化したり、他人と比較（外部から強制）したりするものではないことをマネージャーに説明する。', 'メンバーの評価制度にベロシティの達成度を組み込む。', 'ポイントの基準（1ポイントの重み）を変えて、見かけのベロシティを増やす。'], correct: 1, explanation: 'ベロシティは、過去にそのチームが実際にどれだけこなせたかを示す「実績・予測のための指標」です。経営層がノルマとして設定し、プレッシャーをかけるツールとして使うことはアンチパターン（誤った運用）であり、見積もりのインフレーションなどの副作用を生みます。' }
        ]);
    }
};
